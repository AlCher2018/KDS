История изменений KDSWinSvcHost.exe - служба КДС (библиотечный файл)
======================================================================
!ВНИМАНИЕ! Возможные ошибки запуска службы смотри в конце этого файла.


Версия 1.0.0.7
--------------
2017-08-01 Обновлена логика работы со ВЧЕРАШНИМИ заказами. В настоящее время, вчерашние заказы, т.е. те, у которых дата создания меньше начала текущего дня (полночь), НЕ отображаются на КДСе, вне зависимости от их статуса. Т.е. заказ, созданный в 23:59:50, через 10 секунд пропадет с экранов КДСов, несмотря на то, что он может только готовиться, и перевести его в статус Готов или Выдан с КДС уже будет невозможно.
Однако:
	1. Можно указать промежуток времени (в часах), который отсчитывается назад от полуночи и заказы, созданные в этом промежутке, НЕ БУДУТ считаться вчерашними, следовательно БУДУТ отображаться на КДСе и МОЖНО будет изменять из статус. Для этого в config-файл добавлен новый элемент:
    <!-- период времени назад (в часах) от полуночи, созданные в течение которого ВЧЕРАШНИЕ заказы БУДУТ отображаться на КДСе -->
    <add key="MidnightShiftShowYesterdayOrders" value="1.5"/>
	Например, для указанного выше значения - 1,5 часа, заказы, созданные ВЧЕРА ПОСЛЕ 22ч30мин БУДУТ отображаться на КДСе СЕГОДНЯ. А заказы, созданные вчера ДО 22ч30мин - НЕ БУДУТ отображаться на КДСе.
	Если элемент в config-файле не указан (или закомментирован), то его значение равно 0.
	2. Можно АВТОМАТИЧЕСКИ изменить статус вчерашних, НЕВЫДАННЫХ заказов на такой, который не отображается на КДСах. 
	Для этого в config-файле имеется элемент:
    <!-- время суток, когда НЕВЫДАННЫЕ вчерашние заказы (StatusId < 3) переводятся в статус YesterdayNotTook(=9) -->
    <!--<add key="TimeOfAutoCloseYesterdayOrders" value="07:00:00"/>-->
	Например, для указанного выше значения (07:00:00), при наступлении 7 часов утра (или позже, когда будет запущен КДС-сервис), для всех вчерашних, невыданных заказов в БД будет записан статус 9, который НЕ отображается на КДС.
	При определении вчерашнего заказа, учитывается и п.1. Т.е. заказы, созданные вчера ДО 22ч30мин (из примера п.1) БУДУТ переведены в статус ВчерашнийНеЗабран и исчезнут сегодня после 7 часов утра с экранов КДСов. А заказы, созданные вчера ПОСЛЕ 22ч30мин, НЕ будут сегодня автоматически переведены в другой статус и останутся на экранах КДСов.
	Если элемент в config-файле не указан (или закомментирован), то вчерашние, невыданные заказы не будут автоматически изменять свой статус.


Версия 1.0.0.6
--------------
2017-07-24 Удалена проверка, является ли позиция заказа блюдом, при попытке автостарта приготовления данной позиции. Сейчас автостарт осуществляется для любой позиции заказа, независимо блюдо это или ингредиент.
Лог запросов к БД (KDSDBCommands.log) сейчас пишется в папку Logs приложения.

Версия 1.0.0.5
--------------
2017-07-18 Продолжается поиск решения проблемы синхронизации состояний блюд/заказов, при которой происходит возврат в предыдущее состояние.
В данной версии добавлена блокировка заказа на службе от изменения по таймеру при запросе от клиента на изменение состояния.
Для одновременного логирования работы службы и клиента в config-файле есть элемент
<add key="SingleClientSvcLog" value="true"/>
Если значение true, то создается файл c:\KDSDBCommands.log, в который будет записываться трассировочная информация от службы.


Версия 1.0.0.4
--------------
2017-07-14 Исправлена ошибка, когда при записи с КДСа нового состояния блюда в БД, другой программный поток (периодический опрос заказов) возвращает это блюд в предыдущее состояние. Чем медленнее происходит фиксация нового значения в MS SQL Server и чем *меньше* заказов, тем чаще возникает данная ошибка. На экране КДСа это проявлялось как неизменение состояния блюда (очень быстро происходила перезапись на предыдущее значение) или как видимое изменение, а потом восстановление.


Версия 1.0.0.3
--------------
2017-07-11 Добавлены дополнительные проверки значений даты при записи в статистические таблицы.
В файл KDSService.config добавлен элемент <add key="UnusedDepartments" value=""/> - список (через запятую) Id цехов (направлений печати), которые не должны отображаться на КДСах.
2017-07-12 Изменен код для корректного отображения заказов в случае двухэтапного перехода в состояние Готов.

Версия 1.0.0.2
--------------
2017-07-10 В лог добавлено больше отладочной информации, особенно для операций записи в БД. 
!!!! Важно, чтобы элемент <add key="IsWriteTraceMessages" value="true"/> имел значение True !!!!


Версия 1.0.0.1
--------------
2017-07-03 Добавлена возможность записи в лог действий пользователя, напр. изменение статуса блюда/заказа (префикс сообщения - userAct). При инициализации приложения в лог записывается номер запущенной версии.


Версия 1.0.0.0
--------------
2017-06-27 Функционал КДС собран в отдельный библиотечный файл для хостинга в любом приложении (консольное приложение, Windows-служба).


///////////////////////////////////////
//  Возможные ошибки запуска службы
///////////////////////////////////////
1. При старте службы на экране появляется сообщение об ошибке 1067. Unable to load the specified metadata resource
Причина: в описании строки подключения (<add name="KDSEntities" connectionString="metadata=...; provider=...">) неверно указано значение metadata.
Исправление: в текущей версии службы значение параметра metadata должно быть таким:
	metadata=res://*/DataSource.KDSEntities.csdl|res://*/DataSource.KDSEntities.ssdl|res://*/DataSource.KDSEntities.msl

2. На экране: Не удалось запустить службу KDS Service на Локальный компьютер. Ошибка 1067. Процесс был неожиданно завершен. 
В логе: Ошибка инициализации сервисного класса: Ошибка проверки доступа к базе данных: При установлении соединения с SQL Server произошла ошибка, связанная с сетью или с определенным экземпляром.
Решение: необходимо проверить параметры подключения к БД MS SQL Server: имя ПК, на котором находится MS SQL Server, имя БД, имя пользователя и пароль. Эти параметры находятся в файле KDSService.config, строка
    <add name="KDSEntities" connectionString="metadata=res://*/DataSource.KDSEntities.csdl|res://*/DataSource.KDSEntities.ssdl|res://*/DataSource.KDSEntities.msl;provider=System.Data.SqlClient;provider connection string=&quot;data source=PRG01;initial catalog=KDS1;persist security info=True;user id=testUser;password=test;MultipleActiveResultSets=True;App=EntityFramework&quot;" providerName="System.Data.EntityClient"/>
Параметры подключения:
	data source		- имя ПК, на котором находится MS SQL Server
	initial catalog - имя БД
	user id			- имя пользователя, имеющего доступ для чтения/записи к БД
	password		- пароль пользователя



